<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MediConseil ‚Äì Chatbot M√©dical</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    :root {
      /* Palette de couleurs apaisante */
      --primary: #0284c7;
      --primary-light: #38bdf8;
      --primary-dark: #0369a1;
      --accent: #8b5cf6;
      --accent-light: #c4b5fd;
      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #ef4444;
      --bg-color: #f8fafc;
      --text-color: #1e293b;
      --text-light: #64748b;
      --border-color: #e2e8f0;
      --sidebar-bg: #f1f5f9;
      --chat-bg: #f0f7ff;
      --message-user-bg: linear-gradient(to right, #60a5fa, #3b82f6);
      --message-bot-bg: #f3e8ff;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      line-height: 1.5;
      overflow-x: hidden;
      height: 100vh;
    }

    .app-container {
      display: flex;
      height: 100vh;
      overflow: hidden;
      position: relative;
    }

    /* Sidebar Styles */
    .sidebar {
      width: 280px;
      background: var(--sidebar-bg);
      border-right: 1px solid var(--border-color);
      display: flex;
      flex-direction: column;
      transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      position: relative;
      z-index: 30;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      height: 100vh;
      transform: translateX(0);
    }

    .sidebar.collapsed {
      transform: translateX(-100%);
    }

    .sidebar-backdrop {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.3);
      z-index: 20;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .sidebar-header {
      padding: 1.25rem;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo-container {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .logo-icon {
      width: 32px;
      height: 32px;
      color: var(--primary);
    }

    .logo-text {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--primary);
    }

    .user-profile {
      padding: 1.25rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      border-bottom: 1px solid var(--border-color);
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      background: var(--primary);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
    }

    .user-info {
      flex: 1;
    }

    .user-name {
      font-weight: 500;
      color: var(--text-color);
    }

    .user-status {
      font-size: 0.875rem;
      color: var(--success);
    }

    .new-chat-btn {
      margin: 1.25rem;
      padding: 0.75rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 0.5rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      cursor: pointer;
      transition: background-color 0.2s, transform 0.2s;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .new-chat-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
    }

    .new-chat-btn:active {
      transform: translateY(0);
    }

    .history-section {
      flex: 1;
      overflow-y: auto;
      padding: 1.25rem;
    }

    .history-title {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-light);
      margin-bottom: 0.75rem;
      letter-spacing: 0.05em;
    }

    .session-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .session-item {
      padding: 0.75rem;
      background: white;
      border-radius: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    .session-item:hover {
      background: var(--primary-light);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .session-info {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .session-menu-btn {
      background: none;
      border: none;
      color: inherit;
      cursor: pointer;
      padding: 0.25rem;
      border-radius: 0.25rem;
      opacity: 0.7;
      transition: all 0.2s ease;
    }

    .session-menu-btn:hover {
      opacity: 1;
      background: rgba(255, 255, 255, 0.1);
      transform: scale(1.1);
    }

    .session-dropdown {
      display: none;
      position: absolute;
      top: 100%;
      right: 0;
      background: white;
      border-radius: 0.5rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 50;
      min-width: 160px;
      animation: fadeIn 0.2s ease-in-out;
      overflow: hidden;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .session-dropdown button {
      width: 100%;
      padding: 0.75rem 1rem;
      border: none;
      background: none;
      text-align: left;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      color: var(--text-color);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .session-dropdown button:hover {
      background: var(--bg-color);
    }

    .session-dropdown .rename-btn {
      color: var(--primary);
    }

    .session-dropdown .rename-btn:hover {
      background-color: rgba(56, 189, 248, 0.1);
    }

    .session-dropdown .delete-btn {
      color: var(--danger);
    }

    .session-dropdown .delete-btn:hover {
      background-color: rgba(239, 68, 68, 0.1);
    }

    .logout-btn {
      margin: 1.25rem;
      padding: 0.75rem;
      background: var(--danger);
      color: white;
      border: none;
      border-radius: 0.5rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      cursor: pointer;
      transition: background-color 0.2s, transform 0.2s;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .logout-btn:hover {
      background: #dc2626;
      transform: translateY(-2px);
    }

    .logout-btn:active {
      transform: translateY(0);
    }

    /* Chat Area Styles */
    .chat-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: var(--chat-bg);
      position: relative;
      transition: margin-left 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .chat-area.expanded {
      margin-left: -280px;
    }

    .chat-header {
      padding: 1rem 1.5rem;
      background: white;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .header-title {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-weight: 600;
    }

    .header-actions {
      display: flex;
      gap: 0.5rem;
    }

    .action-btn {
      background: none;
      border: none;
      padding: 0.5rem;
      border-radius: 0.375rem;
      color: var(--text-light);
      cursor: pointer;
      transition: all 0.2s;
    }

    .action-btn:hover {
      background: var(--bg-color);
      color: var(--text-color);
    }

    .sidebar-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      background: none;
      border: none;
      color: var(--text-color);
      font-size: 1.25rem;
      cursor: pointer;
      padding: 0.5rem;
      border-radius: 0.375rem;
      transition: all 0.2s;
    }

    .sidebar-toggle:hover {
      background: var(--bg-color);
      transform: scale(1.05);
    }

    .messages-container {
      flex: 1;
      padding: 1.5rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%239C92AC' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
      scrollbar-width: none; /* Firefox */
    }

    .messages-container::-webkit-scrollbar {
      display: none; /* Chrome, Safari, Edge */
    }

    .message-container {
      display: flex;
      gap: 1rem;
      opacity: 0;
      transform: translateY(20px);
      animation: messageAppear 0.3s ease forwards;
    }

    .message-container.user {
      flex-direction: row-reverse;
    }

    .message {
      max-width: 70%;
      padding: 1rem 1.25rem;
      border-radius: 1rem;
      position: relative;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .message.user {
      background: var(--message-user-bg);
      color: white;
      border-bottom-right-radius: 0.25rem;
    }

    .message.bot {
      background: var(--message-bot-bg);
      color: var(--text-color);
      border-bottom-left-radius: 0.25rem;
    }

    .message.bot-bubble {
      background: #f3e8ff;
      color: #1e293b;
      font-size: 15px;
      line-height: 1.6;
    }

    .message.bot-bubble ul,
    .message.bot-bubble ol {
      margin: 8px 0;
      padding-left: 20px;
    }

    .message.bot-bubble li {
      margin: 4px 0;
    }

    .message.bot-bubble strong {
      color: #0ea5e9;
      font-weight: 600;
    }

    .message.bot-bubble h3 {
      color: #0ea5e9;
      font-size: 16px;
      font-weight: 600;
      margin: 12px 0 8px 0;
    }

    .message.bot-bubble p {
      margin: 8px 0;
    }

    .message.bot-bubble .emoji {
      font-size: 18px;
      margin-right: 4px;
      vertical-align: middle;
    }

    .message.bot-bubble .highlight {
      background: rgba(14, 165, 233, 0.1);
      padding: 2px 6px;
      border-radius: 4px;
    }

    .message.bot-bubble .separator {
      border-top: 1px solid rgba(203, 213, 225, 0.5);
      margin: 12px 0;
    }

    .input-container {
      padding: 1.25rem;
      background: white;
      border-top: 1px solid var(--border-color);
      display: flex;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.03);
      position: relative;
    }

    .input-container::before {
      content: '';
      position: absolute;
      top: -30px;
      left: 0;
      right: 0;
      height: 30px;
      background: linear-gradient(to top, rgba(240, 247, 255, 0.9), rgba(240, 247, 255, 0));
      pointer-events: none;
    }

    .input-wrapper {
      flex: 1;
      position: relative;
      display: flex;
      align-items: center;
      border: 1px solid var(--border-color);
      border-radius: 1.5rem;
      background: white;
      transition: all 0.2s;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    .input-wrapper:focus-within {
      border-color: var(--primary);
      box-shadow: 0 0 0 2px var(--primary-light);
    }

    #userInput {
      flex: 1;
      padding: 0.75rem 1rem;
      border: none;
      border-radius: 1.5rem;
      font-size: 1rem;
      resize: none;
      min-height: 45px;
      max-height: 150px;
      overflow-y: auto;
      scrollbar-width: none; /* Firefox */
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: transparent;
    }

    #userInput::-webkit-scrollbar {
      display: none; /* Chrome, Safari, Edge */
    }

    #userInput:focus {
      outline: none;
    }

    .emoji-btn {
      background: none;
      border: none;
      color: var(--text-light);
      padding: 0.5rem;
      font-size: 1.25rem;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .emoji-btn:hover {
      color: var(--primary);
      transform: scale(1.1);
    }

    .send-btn {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      margin-right: 0.25rem;
    }

    .send-btn:hover {
      background: var(--primary-dark);
      transform: scale(1.05);
    }

    .send-btn:active {
      transform: scale(0.95);
    }

    /* Welcome Menu Styles */
    .welcome-menu {
      max-width: 600px;
      margin: 2rem auto;
      padding: 2rem;
      background: white;
      border-radius: 1rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .welcome-menu::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 6px;
      background: linear-gradient(to right, var(--primary), var(--accent));
      border-radius: 6px 6px 0 0;
    }

    .welcome-menu::after {
      content: '';
      position: absolute;
      bottom: -50px;
      right: -50px;
      width: 150px;
      height: 150px;
      background: linear-gradient(135deg, var(--accent-light) 0%, rgba(255,255,255,0) 70%);
      border-radius: 50%;
      opacity: 0.5;
      z-index: 0;
    }

    .welcome-icon {
      width: 64px;
      height: 64px;
      margin: 0 auto 1.5rem;
      color: var(--primary);
      position: relative;
      z-index: 1;
    }

    .welcome-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-color);
      margin-bottom: 1rem;
      position: relative;
      z-index: 1;
    }

    .welcome-text {
      color: var(--text-light);
      margin-bottom: 2rem;
      position: relative;
      z-index: 1;
    }

    .suggestion-container {
      text-align: left;
      position: relative;
      z-index: 1;
    }

    .suggestion-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-light);
      margin-bottom: 1rem;
    }

    .suggestion-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 0.75rem;
    }

    .suggestion-buttons button {
      padding: 0.75rem 1rem;
      background: white;
      border: 1px solid var(--border-color);
      border-radius: 0.5rem;
      color: var(--text-color);
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      position: relative;
      overflow: hidden;
    }

    .suggestion-buttons button::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(to right, var(--primary), var(--accent));
      opacity: 0;
      transition: opacity 0.2s;
      z-index: -1;
    }

    .suggestion-buttons button:hover {
      color: white;
      border-color: transparent;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .suggestion-buttons button:hover::after {
      opacity: 1;
    }

    .suggestion-buttons button:hover svg {
      color: white;
    }

    .suggestion-buttons button svg {
      color: var(--primary);
      transition: color 0.2s;
    }

    /* Toast Notification System */
    .toast-container {
      position: fixed;
      top: 1rem;
      right: 1rem;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      max-width: 300px;
    }

    .toast {
      padding: 1rem;
      border-radius: 0.5rem;
      background: white;
      color: var(--text-color);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      display: flex;
      align-items: center;
      gap: 0.75rem;
      animation: toastIn 0.3s ease forwards;
      position: relative;
      overflow: hidden;
    }

    .toast::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
    }

    .toast.success::before {
      background: var(--success);
    }

    .toast.warning::before {
      background: var(--warning);
    }

    .toast.error::before {
      background: var(--danger);
    }

    .toast-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .toast.success .toast-icon {
      color: var(--success);
      background: rgba(34, 197, 94, 0.1);
    }

    .toast.warning .toast-icon {
      color: var(--warning);
      background: rgba(245, 158, 11, 0.1);
    }

    .toast.error .toast-icon {
      color: var(--danger);
      background: rgba(239, 68, 68, 0.1);
    }

    .toast-content {
      flex: 1;
    }

    .toast-close {
      background: none;
      border: none;
      color: var(--text-light);
      cursor: pointer;
      padding: 0.25rem;
      border-radius: 0.25rem;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .toast-close:hover {
      background: var(--bg-color);
      color: var(--text-color);
    }

    .toast-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 3px;
      background: rgba(0, 0, 0, 0.1);
      width: 100%;
    }

    .toast-progress::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 100%;
      background: var(--primary-light);
      animation: progress 3s linear forwards;
    }

    @keyframes toastIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes toastOut {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }

    @keyframes progress {
      from { width: 100%; }
      to { width: 0%; }
    }

    /* Modal Dialogs */
    .modal-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .modal-backdrop.active {
      opacity: 1;
      visibility: visible;
    }

    .modal-container {
      background: white;
      border-radius: 0.75rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      width: 90%;
      max-width: 400px;
      transform: translateY(20px);
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .modal-backdrop.active .modal-container {
      transform: translateY(0);
    }

    .modal-header {
      padding: 1.25rem;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .modal-title {
      font-weight: 600;
      color: var(--text-color);
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .modal-body {
      padding: 1.25rem;
    }

    .modal-footer {
      padding: 1.25rem;
      border-top: 1px solid var(--border-color);
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
    }

    .btn {
      padding: 0.75rem 1rem;
      border-radius: 0.5rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .btn-secondary {
      background: var(--bg-color);
      color: var(--text-color);
      border: 1px solid var(--border-color);
    }

    .btn-secondary:hover {
      background: var(--border-color);
    }

    .btn-danger {
      background: var(--danger);
      color: white;
      border: none;
    }

    .btn-danger:hover {
      background: #dc2626;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
      border: none;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
    }

    .input-group {
      margin-bottom: 1rem;
    }

    .input-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--text-color);
    }

    .input-group input {
      width: 100%;
      padding: 0.75rem 1rem;
      border: 1px solid var(--border-color);
      border-radius: 0.5rem;
      font-size: 1rem;
      transition: all 0.2s;
    }

    .input-group input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px var(--primary-light);
    }

    /* Emoji picker */
    .emoji-picker {
      position: absolute;
      bottom: 100%;
      right: 0;
      background: white;
      border-radius: 0.5rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      padding: 0.5rem;
      display: none;
      grid-template-columns: repeat(8, 1fr);
      gap: 0.25rem;
      z-index: 20;
      max-width: 300px;
      margin-bottom: 0.5rem;
    }

    .emoji-picker.active {
      display: grid;
    }

    .emoji-item {
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border-radius: 0.25rem;
      transition: all 0.2s;
      font-size: 1.2rem;
    }

    .emoji-item:hover {
      background: var(--bg-color);
      transform: scale(1.1);
    }

    /* Mobile Responsive Improvements */
    @media (max-width: 768px) {
      .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        bottom: 0;
        z-index: 50;
        transform: translateX(-100%);
      }

      .sidebar.active {
        transform: translateX(0);
      }

      .sidebar-backdrop.active {
        display: block;
        opacity: 1;
      }

      .welcome-menu {
        margin: 1rem;
        padding: 1.5rem;
      }

      .suggestion-buttons {
        grid-template-columns: 1fr;
      }

      .message {
        max-width: 85%;
      }
      
      .chat-header {
        padding: 0.75rem 1rem;
      }
      
      .header-title h2 {
        font-size: 1rem;
      }
      
      .sidebar-toggle {
        padding: 0.375rem;
      }

      .chat-area.expanded {
        margin-left: 0;
      }
    }

    /* Animations and decorative elements */
    @keyframes messageAppear {
      0% {
        opacity: 0;
        transform: translateY(20px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Staggered animation delay for multiple messages */
    .message-container:nth-child(1) { animation-delay: 0ms; }
    .message-container:nth-child(2) { animation-delay: 100ms; }
    .message-container:nth-child(3) { animation-delay: 200ms; }
    .message-container:nth-child(4) { animation-delay: 300ms; }
    .message-container:nth-child(5) { animation-delay: 400ms; }

    /* Accessibility - Respect Reduced Motion Preference */
    @media (prefers-reduced-motion: reduce) {
      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
      }
      
      .welcome-icon {
        animation: none !important;
      }
      
      .typing-dots span {
        animation: none !important;
      }
      
      .session-item:hover {
        transform: none !important;
      }
    }

    /* Typing indicator animation */
    .typing-dots span {
      animation: blink 1.2s infinite;
      font-size: 20px;
      display: inline-block;
    }

    .typing-dots span:nth-child(2) {
      animation-delay: 0.2s;
    }
    .typing-dots span:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes blink {
      0% { opacity: 0.2; }
      20% { opacity: 1; }
      100% { opacity: 0.2; }
    }

    .user-msg {
      justify-content: flex-end;
    }

    .bot-msg {
      justify-content: flex-start;
      align-items: flex-start;
    }

    .bot-avatar {
      width: 40px;
      height: 40px;
      margin-right: 8px;
      background: #dbeafe;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      margin-top: 4px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .bot-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* Decorative elements */
    .decoration-top {
      position: absolute;
      top: 0;
      right: 0;
      width: 150px;
      height: 150px;
      background: linear-gradient(135deg, var(--primary-light) 0%, rgba(255,255,255,0) 70%);
      border-radius: 0 0 0 100%;
      opacity: 0.1;
      z-index: 0;
      pointer-events: none;
    }

    .decoration-bottom {
      position: absolute;
      bottom: 70px;
      left: 0;
      width: 120px;
      height: 120px;
      background: linear-gradient(45deg, var(--accent-light) 0%, rgba(255,255,255,0) 70%);
      border-radius: 0 100% 0 0;
      opacity: 0.1;
      z-index: 0;
      pointer-events: none;
    }

    /* Animation for welcome icon */
    @keyframes iconPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .welcome-icon svg {
      animation: iconPulse 2s ease-in-out infinite;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Sidebar backdrop for mobile -->
    <div class="sidebar-backdrop" id="sidebarBackdrop"></div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="logo-container">
          <div class="logo-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 12h6m-3-3v6m-8 3a9 9 0 1 1 18 0 9 9 0 0 1-18 0z"></path>
            </svg>
          </div>
          <h1 class="logo-text">MediConseil</h1>
        </div>
        
        <!-- Close sidebar button -->
        <button class="sidebar-toggle" id="closeSidebar">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <div class="user-profile">
        <div class="user-avatar" id="userInitial">?</div>
        <div class="user-info">
          <p class="user-name" id="userName">Utilisateur</p>
          <p class="user-status">En ligne</p>
        </div>
      </div>

      <button class="new-chat-btn" onclick="startNewSession()">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 5v14m-7-7h14" />
        </svg>
        Nouveau Chat
      </button>

      <div class="history-section">
        <h2 class="history-title">HISTORIQUE</h2>
        <div class="session-list" id="sessionList"></div>
      </div>

      <button class="logout-btn" onclick="logout()">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
          <polyline points="16 17 21 12 16 7" />
          <line x1="21" y1="12" x2="9" y2="12" />
        </svg>
        D√©connexion
      </button>
    </aside>

    <!-- Main chat area -->
    <main class="chat-area" id="chat">
      <!-- Decorative elements -->
      <div class="decoration-top"></div>
      <div class="decoration-bottom"></div>
      
      <header class="chat-header">
        <!-- Toggle sidebar button -->
        <button class="sidebar-toggle" id="openSidebar">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
        </button>
        
        <div class="header-title">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
          </svg>
          <h2>Consultation M√©dicale</h2>
        </div>
        <div class="header-actions">
          <button class="action-btn info-btn" title="Informations">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10" />
              <line x1="12" y1="16" x2="12" y2="12" />
              <line x1="12" y1="8" x2="12.01" y2="8" />
            </svg>
          </button>
        </div>
      </header>

      <div class="messages-container" id="messages">
        <!-- Welcome menu will be injected here -->
      </div>

      <div class="input-container" id="inputWrapper">
        <div class="input-wrapper">
          <textarea id="userInput" placeholder="D√©crivez vos sympt√¥mes..." rows="1"></textarea>
          
          <!-- Emoji button -->
          <button class="emoji-btn" id="emojiBtn">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
              <line x1="9" y1="9" x2="9.01" y2="9"></line>
              <line x1="15" y1="9" x2="15.01" y2="9"></line>
            </svg>
          </button>

          <!-- Emoji picker -->
          <div class="emoji-picker" id="emojiPicker">
            <!-- Emojis will be added here by JavaScript -->
          </div>
          
          <!-- Send button -->
          <button class="send-btn" onclick="sendMessage()">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="22" y1="2" x2="11" y2="13" />
              <polygon points="22 2 15 22 11 13 2 9 22 2" />
            </svg>
          </button>
        </div>
      </div>
    </main>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>
  
  <!-- Template for welcome menu -->
  <template id="welcome-template">
    <div class="welcome-menu" id="welcomeMenu">
      <div class="welcome-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M9 12h6m-3-3v6m-8 3a9 9 0 1 1 18 0 9 9 0 0 1-18 0z" />
        </svg>
      </div>
      <h1 class="welcome-title">Bienvenue sur <strong>MediConseil</strong> !</h1>
      <p class="welcome-text">Je suis votre assistant m√©dical virtuel. Comment puis-je vous aider aujourd'hui ?</p>

      <div class="suggestion-container">
        <h3 class="suggestion-title">Suggestions</h3>
        <div class="suggestion-buttons">
          <button onclick="suggestionClicked('J\'ai mal √† la t√™te')">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="8" r="7" />
              <path d="M8.21 13.89L7 23l5-3 5 3-1.21-9.12" />
            </svg>
            Mal de t√™te
          </button>
          <button onclick="suggestionClicked('J\'ai de la fi√®vre')">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 14.76V3.5a2.5 2.5 0 0 0-5 0v11.26a4.5 4.5 0 1 0 5 0z" />
            </svg>
            Fi√®vre
          </button>
          <button onclick="suggestionClicked('J\'ai mal au ventre')">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M6.5 12a5.5 5.5 0 1 0 11 0 5.5 5.5 0 1 0-11 0z" />
              <path d="M12 19c-7 0-10-8-10-8s3-8 10-8 10 8 10 8-3 8-10 8z" />
            </svg>
            Douleur abdominale
          </button>
          <button onclick="suggestionClicked('J\'ai des vertiges')">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10" />
              <path d="M12 8v4M12 16h.01" />
            </svg>
            Vertiges
          </button>
          <button onclick="suggestionClicked('Je me sens anxieux')">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20.42 4.58a5.4 5.4 0 0 0-7.65 0l-.77.78-.77-.78a5.4 5.4 0 0 0-7.65 0C1.46 6.7 1.33 10.28 4 13l8 8 8-8c2.67-2.72 2.54-6.3.42-8.42z" />
            </svg>
            Anxi√©t√©
          </button>
          <button onclick="suggestionClicked('Je souhaite des conseils sur le sommeil')">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
            </svg>
            Sommeil
          </button>
        </div>
      </div>
    </div>
  </template>

  <!-- Template for session item -->
  <template id="session-item-template">
    <div class="session-item">
      <div class="session-info">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
        </svg>
        <span class="session-title"></span>
      </div>
      <button class="session-menu-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="1" />
          <circle cx="19" cy="12" r="1" />
          <circle cx="5" cy="12" r="1" />
        </svg>
      </button>
      <div class="session-dropdown">
        <button class="rename-btn">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 20h9" />
            <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z" />
          </svg>
          Renommer
        </button>
        <button class="delete-btn">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="3 6 5 6 21 6" />
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
          </svg>
          Supprimer
        </button>
      </div>
    </div>
  </template>

  <!-- Templates for modals -->
  <template id="confirm-delete-template">
    <div class="modal-backdrop" id="confirmDeleteModal">
      <div class="modal-container">
        <div class="modal-header">
          <h3 class="modal-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2">
              <polyline points="3 6 5 6 21 6" />
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
            </svg>
            Confirmer la requette
          </h3>
        </div>
        <div class="modal-body">
          <p>√ätes-vous s√ªr de vouloir continuer ? </p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-action="cancel">Annuler</button>
          <button class="btn btn-danger" data-action="confirm">Oui</button>
        </div>
      </div>
    </div>
  </template>

  <template id="rename-session-template">
    <div class="modal-backdrop" id="renameSessionModal">
      <div class="modal-container">
        <div class="modal-header">
          <h3 class="modal-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#0284c7" stroke-width="2">
              <path d="M12 20h9" />
              <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z" />
            </svg>
            Renommer la session
          </h3>
        </div>
        <div class="modal-body">
          <div class="input-group">
            <label for="sessionName">Nouveau nom :</label>
            <input type="text" id="sessionName" placeholder="Entrez un nouveau nom...">
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-action="cancel">Annuler</button>
          <button class="btn btn-primary" data-action="confirm">Renommer</button>
        </div>
      </div>
    </div>
  </template>

  <!-- Bootstrap JS (Optional) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    // √âtat global
    let currentSessionId = null;
    let isTyping = false;
    let sidebarOpen = window.innerWidth > 768;

    // Initialisation
    document.addEventListener('DOMContentLoaded', () => {
      loadSessions();
      setupEventListeners();
      showWelcomeMenu();
      setupSidebarToggle();
      setupEmojiPicker();
    });

    // Toast Notification System
    const Toast = {
      create: function(message, type = 'success', duration = 3000) {
        const toastContainer = document.getElementById('toastContainer');
        
        // Create toast element
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        
        // Set icon based on type
        let iconSvg;
        if (type === 'success') {
          iconSvg = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>';
        } else if (type === 'warning') {
          iconSvg = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>';
        } else if (type === 'error') {
          iconSvg = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>';
        }
        
        // Construct toast content
        toast.innerHTML = `
          <div class="toast-icon">${iconSvg}</div>
          <div class="toast-content">${message}</div>
          <button class="toast-close">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
          <div class="toast-progress"></div>
        `;
        
        // Add toast to container
        toastContainer.appendChild(toast);
        
        // Setup close button
        const closeBtn = toast.querySelector('.toast-close');
        closeBtn.addEventListener('click', () => {
          this.dismiss(toast);
        });
        
        // Auto dismiss after duration
        setTimeout(() => {
          this.dismiss(toast);
        }, duration);
        
        return toast;
      },
      
      dismiss: function(toast) {
        toast.style.animation = 'toastOut 0.3s forwards';
        setTimeout(() => {
          toast.remove();
        }, 300);
      }
    };

    // Modal System
    const Modal = {
      show: function(templateId, config = {}) {
        // Clone template
        const template = document.getElementById(templateId);
        const modal = template.content.cloneNode(true);
        document.body.appendChild(modal);
        
        // Get modal elements
        const modalBackdrop = document.querySelector('.modal-backdrop');
        const cancelBtn = modalBackdrop.querySelector('[data-action="cancel"]');
        const confirmBtn = modalBackdrop.querySelector('[data-action="confirm"]');
        
        // Show modal with animation
        setTimeout(() => {
          modalBackdrop.classList.add('active');
        }, 10);
        
        // Setup event handlers
        return new Promise((resolve) => {
          // Cancel button
          cancelBtn.addEventListener('click', () => {
            this.hide(modalBackdrop);
            resolve(false);
          });
          
          // Confirm button
          confirmBtn.addEventListener('click', () => {
            // For rename modal, get the input value
            let result = true;
            if (templateId === 'rename-session-template') {
              const input = modalBackdrop.querySelector('#sessionName');
              result = input.value.trim();
            }
            
            this.hide(modalBackdrop);
            resolve(result);
          });
          
          // Close on backdrop click
          modalBackdrop.addEventListener('click', (e) => {
            if (e.target === modalBackdrop) {
              this.hide(modalBackdrop);
              resolve(false);
            }
          });
        });
      },
      
      hide: function(modal) {
        modal.classList.remove('active');
        setTimeout(() => {
          modal.remove();
        }, 300);
      }
    };

    // Configuration des √©couteurs d'√©v√©nements
    function setupEventListeners() {
      const userInput = document.getElementById('userInput');
      
      // Send message on Enter (not Shift+Enter)
      userInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      });
      
      // Ajustement automatique de la hauteur du textarea
      userInput.addEventListener('input', () => {
        userInput.style.height = 'auto';
        userInput.style.height = Math.min(150, userInput.scrollHeight) + 'px';
      });
      
      // Close emoji picker when clicking outside
      document.addEventListener('click', (e) => {
        const emojiPicker = document.getElementById('emojiPicker');
        const emojiBtn = document.getElementById('emojiBtn');
        
        if (emojiPicker && emojiBtn && !emojiPicker.contains(e.target) && !emojiBtn.contains(e.target)) {
          emojiPicker.classList.remove('active');
        }
      });
    }

    // Setup emoji picker
    function setupEmojiPicker() {
      const emojiBtn = document.getElementById('emojiBtn');
      const emojiPicker = document.getElementById('emojiPicker');
      const userInput = document.getElementById('userInput');
      
      // Common medical emojis
      const emojis = ['üòä', 'üëç', 'üë®‚Äç‚öïÔ∏è', 'üë©‚Äç‚öïÔ∏è', 'üè•', 'üíä', 'üíâ', 'ü©∫', 'ü§í', 'ü§ï', 'ü§¢', 'ü§Æ', 'ü§ß', 
                      'üò∑', 'ü§î', 'üò∞', 'üò®', 'üòì', 'üò£', 'üòñ', 'üò±', 'üòµ', 'ü•µ', 'ü•∂', 'ü§Ø', 'üò¥', 
                      'üôÇ', 'üôÅ', 'üò¢', '‚ù§Ô∏è', 'üëå', 'üëã', 'üôè', 'üí™', 'üß†', 'üëÅÔ∏è', 'üëÇ', 'üëÉ', 'ü¶∑', 'ü¶¥'];
      
      // Populate emoji picker
      emojis.forEach(emoji => {
        const emojiElement = document.createElement('div');
        emojiElement.className = 'emoji-item';
        emojiElement.textContent = emoji;
        emojiElement.addEventListener('click', () => {
          // Insert emoji at cursor position
          const cursorPos = userInput.selectionStart;
          const textBeforeCursor = userInput.value.substring(0, cursorPos);
          const textAfterCursor = userInput.value.substring(cursorPos);
          
          userInput.value = textBeforeCursor + emoji + textAfterCursor;
          
          // Update cursor position
          userInput.selectionStart = cursorPos + emoji.length;
          userInput.selectionEnd = cursorPos + emoji.length;
          
          // Focus back on input
          userInput.focus();
          
          // Trigger input event to adjust height
          userInput.dispatchEvent(new Event('input'));
          
          // Close emoji picker
          emojiPicker.classList.remove('active');
        });
        
        emojiPicker.appendChild(emojiElement);
      });
      
      // Toggle emoji picker
      emojiBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        emojiPicker.classList.toggle('active');
      });
    }

    // Setup sidebar toggle functionality
    function setupSidebarToggle() {
      const openSidebarBtn = document.getElementById('openSidebar');
      const closeSidebarBtn = document.getElementById('closeSidebar');
      const sidebar = document.getElementById('sidebar');
      const backdrop = document.getElementById('sidebarBackdrop');
      const chatArea = document.getElementById('chat');
      
      // Toggle sidebar on all screen sizes
      openSidebarBtn.addEventListener('click', () => {
        if (window.innerWidth <= 768) {
          // On mobile, use fixed positioning
          sidebar.classList.add('active');
          backdrop.classList.add('active');
        } else {
          // On desktop, toggle sidebar visibility
          sidebar.classList.remove('collapsed');
          chatArea.classList.remove('expanded');
        }
        sidebarOpen = true;
      });
      
      // Close sidebar
      closeSidebarBtn.addEventListener('click', () => {
        if (window.innerWidth <= 768) {
          // On mobile, hide the sidebar
          sidebar.classList.remove('active');
          backdrop.classList.remove('active');
        } else {
          // On desktop, collapse sidebar
          sidebar.classList.add('collapsed');
          chatArea.classList.add('expanded');
        }
        sidebarOpen = false;
      });
      
      // Close sidebar when clicking backdrop (mobile only)
      backdrop.addEventListener('click', () => {
        sidebar.classList.remove('active');
        backdrop.classList.remove('active');
        sidebarOpen = false;
      });
      
      // Handle resize to adjust sidebar behavior
      window.addEventListener('resize', () => {
        if (window.innerWidth > 768) {
          // On desktop
          backdrop.classList.remove('active');
          sidebar.classList.remove('active');
          
          // Restore sidebar state based on sidebarOpen
          if (sidebarOpen) {
            sidebar.classList.remove('collapsed');
            chatArea.classList.remove('expanded');
          } else {
            sidebar.classList.add('collapsed');
            chatArea.classList.add('expanded');
          }
        } else {
          // On mobile
          sidebar.classList.remove('collapsed');
          chatArea.classList.remove('expanded');
          
          if (sidebarOpen) {
            sidebar.classList.add('active');
            backdrop.classList.add('active');
          }
        }
      });
      
      // Initial state setup
      if (window.innerWidth <= 768) {
        // On mobile, sidebar is hidden by default
        sidebar.classList.remove('active');
        sidebarOpen = false;
      } else {
        // On desktop, sidebar is visible by default
        sidebar.classList.remove('collapsed');
        chatArea.classList.remove('expanded');
        sidebarOpen = true;
      }
    }

    // Affichage du menu de bienvenue
    function showWelcomeMenu() {
      const template = document.getElementById('welcome-template');
      const messages = document.getElementById('messages');
      if (template && messages) {
        messages.innerHTML = '';
        messages.appendChild(template.content.cloneNode(true));
      }
    }

    // Gestion des sessions
    async function startNewSession() {
      try {
        const res = await fetch('/api/session/new', {
          method: 'POST',
          credentials: 'include'
        });
        
        if (!res.ok) throw new Error('Erreur cr√©ation session');
        
        const data = await res.json();
        currentSessionId = data.sessionId;
        document.getElementById('messages').innerHTML = '';
        showWelcomeMenu();
        loadSessions();
        
        // Show success notification
        Toast.create('Nouvelle session cr√©√©e avec succ√®s', 'success');
        
        // On mobile, close sidebar after creating new session
        if (window.innerWidth <= 768) {
          const sidebar = document.getElementById('sidebar');
          const backdrop = document.getElementById('sidebarBackdrop');
          sidebar.classList.remove('active');
          backdrop.classList.remove('active');
          sidebarOpen = false;
        }
      } catch (err) {
        console.error('Erreur:', err);
        Toast.create('Impossible de cr√©er une nouvelle session', 'error');
      }
    }

    async function loadSessions() {
      try {
        const res = await fetch('/api/session/list', {
          credentials: 'include'
        });
        
        const data = await res.json();
        const sessionList = document.getElementById("sessionList");
        sessionList.innerHTML = "";
        
        data.sessions.forEach(session => {
          const item = document.createElement("div");
          item.className = "session-item";
          
          // Format date
          const date = new Date(session.date_creation).toLocaleString();
          
          // Create session info
          const info = document.createElement("div");
          info.className = "session-info";
          info.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
            </svg>
            <span>${session.titre || "Session du " + date}</span>
          `;
          
          // Create menu button
          const menuBtn = document.createElement("button");
          menuBtn.className = "session-menu-btn";
          menuBtn.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="1" />
              <circle cx="19" cy="12" r="1" />
              <circle cx="5" cy="12" r="1" />
            </svg>
          `;
          
          // Create dropdown menu
          const dropdown = document.createElement("div");
          dropdown.className = "session-dropdown";
          dropdown.innerHTML = `
            <button class="rename-btn">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 20h9" />
                <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z" />
              </svg>
              Renommer
            </button>
            <button class="delete-btn">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6" />
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
              </svg>
              Supprimer
            </button>
          `;
          
          // Add elements to session item
          item.appendChild(info);
          item.appendChild(menuBtn);
          item.appendChild(dropdown);
          
          // Session click handler
          item.addEventListener('click', (e) => {
            // Don't trigger if clicking on menu or dropdown
            if (e.target === menuBtn || menuBtn.contains(e.target) || 
                e.target === dropdown || dropdown.contains(e.target)) {
              return;
            }
            
            currentSessionId = session.id;
            loadMessages(session.id);
            
            // On mobile, close sidebar after selecting a session
            if (window.innerWidth <= 768) {
              const sidebar = document.getElementById('sidebar');
              const backdrop = document.getElementById('sidebarBackdrop');
              sidebar.classList.remove('active');
              backdrop.classList.remove('active');
              sidebarOpen = false;
            }
          });
          
          // Menu button click handler
          menuBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            
            // Close all other dropdowns
            document.querySelectorAll('.session-dropdown').forEach(el => {
              if (el !== dropdown) {
                el.style.display = 'none';
              }
            });
            
            // Toggle this dropdown
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
          });
          
          // Rename button click handler
          dropdown.querySelector('.rename-btn').addEventListener('click', async (e) => {
            e.stopPropagation();
            dropdown.style.display = 'none';
            
            const newName = await Modal.show('rename-session-template');
            if (newName) {
              try {
                const response = await fetch(`/api/session/rename/${session.id}`, {
                  method: 'PUT',
                  credentials: 'include',
                  headers: {
                    'Content-Type': 'application/json'
                  },
                  body: JSON.stringify({ title: newName })
                });
                
                if (response.ok) {
                  Toast.create('Session renomm√©e avec succ√®s', 'success');
                  loadSessions();
                } else {
                  Toast.create('Erreur lors du renommage', 'error');
                }
              } catch (err) {
                console.error(err);
                Toast.create('Erreur lors du renommage', 'error');
              }
            }
          });
          
          // Delete button click handler
          dropdown.querySelector('.delete-btn').addEventListener('click', async (e) => {
            e.stopPropagation();
            dropdown.style.display = 'none';
            
            const confirmed = await Modal.show('confirm-delete-template');
            if (confirmed) {
              try {
                const response = await fetch(`/api/session/delete/${session.id}`, {
                  method: 'DELETE',
                  credentials: 'include'
                });
                
                if (response.ok) {
                  Toast.create('Session supprim√©e avec succ√®s', 'success');
                  
                  // If current session was deleted, clear messages
                  if (currentSessionId == session.id) {
                    document.getElementById('messages').innerHTML = '';
                    currentSessionId = null;
                    showWelcomeMenu();
                  }
                  
                  // Reload sessions list
                  loadSessions();
                } else {
                  Toast.create('Erreur lors de la suppression', 'error');
                }
              } catch (err) {
                console.error(err);
                Toast.create('Erreur lors de la suppression', 'error');
              }
            }
          });
          
          sessionList.appendChild(item);
        });
        
        // Close dropdowns when clicking elsewhere
        document.addEventListener('click', () => {
          document.querySelectorAll('.session-dropdown').forEach(dropdown => {
            dropdown.style.display = 'none';
          });
        });
        
      } catch (err) {
        console.error('Erreur chargement sessions:', err);
        Toast.create('Impossible de charger les sessions', 'error');
      }
    }

    // Gestion des messages
    async function loadMessages(sessionId) {
      try {
        const res = await fetch(`/api/messages/${sessionId}`, {
          credentials: 'include'
        });
        
        if (!res.ok) throw new Error('Erreur chargement messages');
        
        const data = await res.json();
        const container = document.getElementById('messages');
        container.innerHTML = '';
        
        data.messages.forEach(msg => {
          appendMessage(msg.question, 'user');
          appendMessage(msg.reponse, 'bot');
        });
        
        // Scroll to bottom after loading messages
        container.scrollTop = container.scrollHeight;
      } catch (err) {
        console.error('Erreur:', err);
        Toast.create('Impossible de charger les messages', 'error');
      }
    }

    async function sendMessage(messageFromSuggestion = null) {
      const input = document.getElementById("userInput");
      const message = messageFromSuggestion || input.value.trim();
      
      if (!message) return;
      
      // Supprimer le menu de bienvenue au premier message
      const welcome = document.getElementById("welcomeMenu");
      if (welcome) welcome.remove();
      
      // Cr√©er une session si aucune n'existe
      if (!currentSessionId) {
        try {
          const res = await fetch('/api/session/new', {
            method: 'POST',
            credentials: 'include'
          });
          
          const data = await res.json();
          currentSessionId = data.sessionId;
          loadSessions();
        } catch (err) {
          Toast.create('Erreur de cr√©ation de session', 'error');
          return;
        }
      }
      
      // Add user message
      appendMessage(message, "user");
      input.value = "";
      
      // Reset textarea height
      input.style.height = 'auto';
      
      // Show typing indicator
      const loader = appendMessage("...", "bot", true);
      
      try {
        const res = await fetch("/api/chat", {
          method: "POST",
          credentials: "include",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            message,
            sessionId: currentSessionId
          })
        });
        
        const data = await res.json();
        
        // Remove typing indicator
        loader.remove();
        
        // Add bot response
        appendMessage(data.reply, "bot");
      } catch (error) {
        loader.remove();
        appendMessage("Erreur serveur", "bot");
        Toast.create('Erreur de communication avec le serveur', 'error');
      }
    }

    function appendMessage(text, sender, isLoading = false) {
      const msgDiv = document.createElement("div");
      msgDiv.className = `message-container ${sender === "user" ? "user-msg" : "bot-msg"}`;
      
      const bubble = document.createElement("div");
      bubble.className = `message ${sender === "user" ? "user-bubble" : "bot-bubble"}`;
      
      if (isLoading) {
        bubble.innerHTML = `<span class="typing-dots"><span>.</span><span>.</span><span>.</span></span>`;
      } else {
        if (sender === "bot") {
          // Convert markdown-style formatting to HTML
          let formattedText = text
            // Convert emoji shortcodes
            .replace(/:warning:/g, '‚ö†Ô∏è')
            .replace(/:info:/g, '‚ÑπÔ∏è')
            .replace(/:check:/g, '‚úÖ')
            .replace(/:cross:/g, '‚ùå')
            .replace(/:star:/g, '‚≠ê')
            .replace(/:bulb:/g, 'üí°')
            .replace(/:pill:/g, 'üíä')
            .replace(/:hospital:/g, 'üè•')
            .replace(/:doctor:/g, 'üë®‚Äç‚öïÔ∏è')
            // Convert markdown to HTML
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
            .replace(/\*(.*?)\*/g, '<em>$1</em>')
            .replace(/### (.*?)\n/g, '<h3>$1</h3>')
            .replace(/\n- /g, '\n‚Ä¢ ')
            .replace(/\n(\d+)\. /g, '\n$1) ')
            // Convert URLs to links
            .replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank">$1</a>')
            // Convert newlines to <br>
            .replace(/\n/g, '<br>');
          
          bubble.innerHTML = formattedText;
        } else {
          bubble.textContent = text;
        }
      }
      
      if (sender === "bot") {
        const avatar = document.createElement("div");
        avatar.className = "bot-avatar";
        avatar.innerHTML = `<img src="/logo.avif" alt="Bot">`;
        msgDiv.appendChild(avatar);
      }
      
      msgDiv.appendChild(bubble);
      document.getElementById("messages").appendChild(msgDiv);
      document.getElementById("messages").scrollTop = document.getElementById("messages").scrollHeight;
      
      return msgDiv;
    }

    // Gestion des suggestions
    function suggestionClicked(text) {
      sendMessage(text);
    }

    // D√©connexion
    async function logout() {
      const confirmed = await Modal.show('confirm-delete-template', {
        title: 'Confirmer la d√©connexion',
        message: '√ätes-vous s√ªr de vouloir vous d√©connecter ?',
        confirmText: 'D√©connexion',
        cancelText: 'Annuler'
      });
      
      if (confirmed) {
        window.location.href = "/index.html";
      }
    }

    // Chargement des informations utilisateur
    fetch('/api/user', {
      method: 'GET',
      credentials: 'include'
    })
    .then(res => {
      if (res.status === 401) {
        console.warn('Non authentifi√©');
        return null;
      }
      return res.json();
    })
    .then(data => {
      if (data && data.email) {
        const initial = data.email.charAt(0).toUpperCase();
        document.getElementById('userInitial').textContent = initial;
        document.getElementById('userName').textContent = data.email;
      } else {
        console.warn('Aucune donn√©e utilisateur');
      }
    })
    .catch(err => {
      console.error('Erreur chargement infos utilisateur:', err);
      Toast.create('Impossible de charger les informations utilisateur', 'error');
    });
  </script>
</body>
</html>